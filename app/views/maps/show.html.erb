<p id="notice"><%= notice %></p>

<p>
  <strong>Name:</strong>
  <%= @map.name %>
</p>

<p>
  <strong>Address:</strong>
  <%= @map.address %>
</p>

<%= link_to 'Edit', edit_map_path(@map) %> |
<%= link_to 'Back', maps_path %>

<div id="address-map" style="width: 100%; height: 400px;" data-name="<%= sanitize @map.name %>" data-address="<%= sanitize @map.address %>"></div>

<script>
// Define a function that should be ran on load
function initialize_my_map() {

    var el = document.getElementById("address-map");

    // Create a geocoder instance
    var geocoder = new google.maps.Geocoder();

    // Geocode the address
    geocoder.geocode({'address': el.dataset.address}, function(results, status){

        // Create a coordinate
        var myCenter = results[0].geometry.location;

        // Map properties
        var mapProp = {
            center: myCenter,
            zoom: 14,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };

        // Create a new map using those properties
        var map = new google.maps.Map(el, mapProp);

        // Create a marker
        var marker = new google.maps.Marker({
            position: myCenter,
        });

        // Drop it
        marker.setMap(map);

        // Create an info window
        var infowindow = new google.maps.InfoWindow({
            content: "<h1>" + el.dataset.name + "</h1>" + results[0].formatted_address
        });

        // Open it above the marker
        infowindow.open(map, marker);

    })

}

// The init function needs to run on load
google.maps.event.addDomListener(window, 'load', initialize_my_map);
google.maps.event.addDomListener(window, 'page:load', initialize_my_map)
</script>
